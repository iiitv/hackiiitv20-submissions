<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Complaints</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="/views/complaints/assets/css/styles.min.css">
    <style>
        .card{
            transition: all 0.5s ease-in-out; 
        }
        .card-body{
        position:relative;
        }
        .card-body img{
            position: absolute;
            top:10px;
            right: 40px;
            width: 100px;
            height: 100px;
        }
        
        .card-wrapper{
            width: 70%;
            border: 2px solid white;
        }
        .user-wrapper-top{
            color:white;
            min-height: 50vh;
            width: 30%;
            background-color: #C70039;
            position:fixed;
            top:0;
            right:0;
            text-align: center;
            padding: 20px;
        }
        .user-wrapper-bottom{
            background-color: #28324B;
            min-height: 50vh;
            position:fixed;
            bottom:0;
            right:0;
            padding: 20px;
            width: 30%;
            display:flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .user-wrapper-top img{
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px solid white;
        }
        .user-wrapper-top h2{
            padding: 20px 0;
        }
        .user-wrapper-top button{
          display:block;
          margin: 40px auto;
          width: 50%;
          padding: 10px;
          font-size: 20px;
        }
        .user-wrapper-bottom button{
          display:block;
          margin: 20px 0;
          width: 100%;
          padding: 10px;
          font-size: 20px;
        }

        .card-body button{
            margin-right: 20px;
            margin-bottom: 15px;
        }

        button{
            background-color: transparent;
            color: white;
            border: 2px solid white;
        }
    </style>
</head>

<body>
    <%let colors = ["#1cbb9b","#2c97df","#9d55b9","#51d88b","#354a5f"]%>
    <%let l=0%>
    <%let branches={"AD": "Administration", "MC": "Mess Committee", "CM": "Campus Manager", "FD": "Financial Department", "RG": "Registrar"}%>
    <%let j=0,k=0%>
    <%let i=1%>    
    <%post.reverse();profilepic.reverse();by.reverse()%>
    <%if(post.length<1){%>
        <center><p><strong>No complaints/help requests yet.</strong></p></center>
    <%}%>
        <%post.forEach(ele=>{%>
    <div class="card-wrapper">   
    <div class="card" style="background-color: <%=colors[l%5]%>;">
        <%l++%>
    <div class="card-body">
        <h4 class="card-title" style="color: white;">#<%=i++%></h4>
        <h5 style="font-family:lucida console;color:white"><b>By:</b>@<%=by[j].username%><%j++%></h5>
        <p class="card-text" style="color: white;margin-right:150px;"><b>Issue: </b><%=ele.post%></p>
        <%if(ele.photo!=null){%>
            <img class="img-fluid" src="data:image/png;base64,<%=ele.photo%>" style="text-align: center;margin-top: 7px;margin-bottom: 10px;float:right"><br>
        <%}%>
        <%if(ele.tag==="Complaint"){%>
            <i><h6 style="color: white;">Status: at Student Admin Level</h6></i>
            <%}else if(ele.tag==="Help"){%>
                <i><h6 style="color: white;">Status: Forwarded to <%=branches[ele.forType]%></h6></i>
                <%}%>
        <a class="card-link" href="/chat/<%=ele._id%>"><button>Chat And Discuss</button></a><a class="card-link" href="#"><button id="<%=ele._id%>" >Mark As Resolved</button></a>
        <%if(user.isSuperAdmin===false){%><a class="card-link" href="#"></a><button id="uAD<%=ele._id%>" >Transfer To Administration</button></a><%}%>
        <%if(user.isSuperAdmin===false){%><a class="card-link" href="#"></a><button id="uCM<%=ele._id%>" >Transfer To Campus Manager</button></a><%}%>
        <%if(user.isSuperAdmin===false){%><a class="card-link" href="#"></a><button id="uMC<%=ele._id%>" >Transfer To Mess Committee</button></a><%}%>
        <%if(user.isSuperAdmin===false){%><a class="card-link" href="#"></a><button id="uFD<%=ele._id%>" >Transfer To Finance Dept.</button></a><%}%>
        <%if(user.isSuperAdmin===false){%><a class="card-link" href="#"></a><button id="uRG<%=ele._id%>" >Transfer To Registrar</button></a><%}%>
    </div>
</div>
</div>

<div class="user-wrapper-top">
    <img src="data:image/png;base64,<%=userprofilepic.profilephoto%>" alt="profilepic">
     <h1><%=user.name%></h1>
     <h3>@<%=user.username%></h3>
     <a href="/logout"><button>Log Out</button></a>
</div>
<div class="user-wrapper-bottom">
    <a href="/announcements"><button>View Announcements</button></a>
    <a href="/createannouncements"><button>Create Announcement</button></a>
</div>

<script>
    document.getElementById('<%=ele._id%>').onclick = function()  {     
        $.post('/resolve/<%=ele._id%>', function(data, status){   
        })
        setTimeout(function () {
            // after 2 seconds
            window.location.reload();
        }, 1500)
    }

    document.getElementById('uAD<%=ele._id%>').onclick = function()  {     
                            $.post('/upgrade/<%=ele._id%>/AD', function(data, status){   
                            })
                            setTimeout(function () {
                                // after 2 seconds
                                window.location.reload();
                            }, 1500)
                            
                        }
                        document.getElementById('uCM<%=ele._id%>').onclick = function()  {     
                            $.post('/upgrade/<%=ele._id%>/CM', function(data, status){   
                            })
                            setTimeout(function () {
                                // after 2 seconds
                                window.location.reload();
                            }, 1500)
                            
                        }
                        document.getElementById('uMC<%=ele._id%>').onclick = function()  {     
                            $.post('/upgrade/<%=ele._id%>/MC', function(data, status){   
                            })
                            setTimeout(function () {
                                // after 2 seconds
                                window.location.reload();
                            }, 1500)
                            
                        }
                        document.getElementById('uFD<%=ele._id%>').onclick = function()  {     
                            $.post('/upgrade/<%=ele._id%>/FD', function(data, status){   
                            })
                            setTimeout(function () {
                                // after 2 seconds
                                window.location.reload();
                            }, 1500)
                            
                        }
                        document.getElementById('uRG<%=ele._id%>').onclick = function()  {     
                            $.post('/upgrade/<%=ele._id%>/RG', function(data, status){   
                            })
                            setTimeout(function () {
                                // after 2 seconds
                                window.location.reload();
                            }, 1500)
                            
                        }
</script>
<%})%>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.bundle.min.js"></script>
</body>

</html>